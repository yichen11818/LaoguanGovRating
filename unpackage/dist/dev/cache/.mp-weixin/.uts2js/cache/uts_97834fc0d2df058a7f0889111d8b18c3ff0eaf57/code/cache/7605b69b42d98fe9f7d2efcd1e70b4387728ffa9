{"code":"import { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            currentTableIndex: 0,\n            tables: [new UTSJSONObject({ _id: '', name: '全部评分表' })],\n            historyList: [],\n            page: 1,\n            pageSize: 10,\n            total: 0,\n            hasMoreData: false,\n            isLoading: false,\n            currentDetail: null,\n            deleteItem: null\n        };\n    },\n    onLoad() {\n        this.loadTables();\n        this.loadHistory();\n    },\n    onPullDownRefresh() {\n        this.reloadData(() => {\n            uni.stopPullDownRefresh();\n        });\n    },\n    methods: {\n        // 重新加载数据\n        reloadData(callback = null) {\n            this.page = 1;\n            this.loadHistory(() => {\n                if (typeof callback === 'function') {\n                    callback();\n                }\n            });\n        },\n        // 加载评分表列表\n        loadTables() {\n            uniCloud.callFunction({\n                name: 'ratingTable',\n                data: new UTSJSONObject({\n                    action: 'getTables',\n                    data: new UTSJSONObject({\n                        pageSize: 100 // 获取所有评分表\n                    })\n                })\n            }).then(res => {\n                if (res.result.code === 0) {\n                    const data = res.result.data;\n                    this.tables = [new UTSJSONObject({ _id: '', name: '全部评分表' })].concat(data.list);\n                }\n            });\n        },\n        // 加载评分历史\n        loadHistory(callback = null) {\n            this.isLoading = true;\n            const tableId = this.tables[this.currentTableIndex]._id;\n            uni.showLoading({\n                title: '加载中...'\n            });\n            uniCloud.callFunction({\n                name: 'rating',\n                data: new UTSJSONObject({\n                    action: 'getRatingHistory',\n                    data: new UTSJSONObject({\n                        table_id: tableId,\n                        page: this.page,\n                        pageSize: this.pageSize\n                    })\n                })\n            }).then(res => {\n                uni.hideLoading();\n                this.isLoading = false;\n                if (res.result.code === 0) {\n                    const data = res.result.data;\n                    if (this.page === 1) {\n                        this.historyList = data.list;\n                    }\n                    else {\n                        this.historyList = this.historyList.concat(data.list);\n                    }\n                    this.total = data.total;\n                    this.hasMoreData = this.historyList.length < this.total;\n                }\n                else {\n                    uni.showToast({\n                        title: res.result.msg || '加载失败',\n                        icon: 'none'\n                    });\n                }\n                if (typeof callback === 'function') {\n                    callback();\n                }\n            }).catch((err = null) => {\n                uni.hideLoading();\n                this.isLoading = false;\n                uni.__f__('error', 'at pages/rater/history/history.vue:265', err);\n                uni.showToast({\n                    title: '加载失败，请检查网络',\n                    icon: 'none'\n                });\n                if (typeof callback === 'function') {\n                    callback();\n                }\n            });\n        },\n        // 处理评分表筛选变化\n        handleTableChange(e = null) {\n            this.currentTableIndex = e.detail.value;\n            this.reloadData();\n        },\n        // 获取评分表类型名称\n        getTableTypeName(type = null) {\n            const typeMap = new UTSJSONObject({\n                1: '(办公室)一般干部评分',\n                2: '(驻村)干部评分',\n                3: '班子评分'\n            });\n            return typeMap[type] || '未知类型';\n        },\n        // 格式化日期时间\n        formatDateTime(timestamp = null) {\n            if (!timestamp)\n                return '';\n            const date = new Date(timestamp);\n            const year = date.getFullYear();\n            const month = String(date.getMonth() + 1).padStart(2, '0');\n            const day = String(date.getDate()).padStart(2, '0');\n            const hours = String(date.getHours()).padStart(2, '0');\n            const minutes = String(date.getMinutes()).padStart(2, '0');\n            return `${year}-${month}-${day} ${hours}:${minutes}`;\n        },\n        // 查看详情\n        viewDetail(item = null) {\n            this.currentDetail = item;\n            this.$refs.detailPopup.open();\n        },\n        // 关闭详情弹窗\n        closeDetail() {\n            this.$refs.detailPopup.close();\n        },\n        // 编辑评分\n        editRating(item = null) {\n            if (this.$refs.detailPopup.isOpen) {\n                this.$refs.detailPopup.close();\n            }\n            if (!item || !item._id || !item.table || !item.table._id) {\n                uni.showToast({\n                    title: '评分记录数据不完整，无法编辑',\n                    icon: 'none'\n                });\n                return null;\n            }\n            uni.navigateTo({\n                url: `/pages/rater/rating/rating?table_id=${item.table._id}&subject_id=${item.subject._id}&rating_id=${item._id}`\n            });\n        },\n        // 确认删除\n        confirmDelete(item = null) {\n            this.deleteItem = item;\n            this.$refs.deletePopup.open();\n        },\n        // 关闭删除确认弹窗\n        closeDeletePopup() {\n            this.$refs.deletePopup.close();\n        },\n        // 删除评分记录\n        deleteRating() {\n            if (!this.deleteItem || !this.deleteItem._id) {\n                uni.showToast({\n                    title: '评分记录数据不完整，无法删除',\n                    icon: 'none'\n                });\n                return null;\n            }\n            uni.showLoading({\n                title: '删除中...'\n            });\n            uniCloud.callFunction({\n                name: 'rating',\n                data: new UTSJSONObject({\n                    action: 'deleteRating',\n                    data: new UTSJSONObject({\n                        rating_id: this.deleteItem._id\n                    })\n                })\n            }).then(res => {\n                uni.hideLoading();\n                if (res.result.code === 0) {\n                    uni.showToast({\n                        title: '删除成功',\n                        icon: 'success'\n                    });\n                    // 从列表中移除已删除的项\n                    const index = this.historyList.findIndex(item => { return item._id === this.deleteItem._id; });\n                    if (index !== -1) {\n                        this.historyList.splice(index, 1);\n                    }\n                }\n                else {\n                    uni.showToast({\n                        title: res.result.msg || '删除失败',\n                        icon: 'none'\n                    });\n                }\n            }).catch((err = null) => {\n                uni.hideLoading();\n                uni.__f__('error', 'at pages/rater/history/history.vue:392', err);\n                uni.showToast({\n                    title: '删除失败，请检查网络',\n                    icon: 'none'\n                });\n            });\n        },\n        // 加载更多\n        loadMore() {\n            if (this.isLoading || !this.hasMoreData)\n                return null;\n            this.page++;\n            this.loadHistory();\n        }\n    }\n});\n//# sourceMappingURL=C:/Users/11818/Documents/laoguan/laoguan/pages/rater/history/history.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.stopPullDownRefresh","uniCloud.callFunction","uni.showLoading","uni.hideLoading","uni.showToast","uni.__f__","uni.navigateTo"],"map":"{\"version\":3,\"file\":\"history.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"history.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}

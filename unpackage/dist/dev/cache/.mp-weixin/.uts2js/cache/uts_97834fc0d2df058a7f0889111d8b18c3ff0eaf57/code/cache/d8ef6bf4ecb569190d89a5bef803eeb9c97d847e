{"code":"import { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            userInfo: new UTSJSONObject({\n                _id: '',\n                username: '',\n                name: '',\n                role: 1,\n                avatar: ''\n            }),\n            passwordForm: new UTSJSONObject({\n                oldPassword: '',\n                newPassword: '',\n                confirmPassword: ''\n            })\n        };\n    },\n    onLoad() {\n        this.loadUserInfo();\n    },\n    methods: {\n        // 加载用户信息\n        loadUserInfo() {\n            // 从本地存储获取用户信息\n            const userInfoStr = uni.getStorageSync('userInfo');\n            if (userInfoStr) {\n                this.userInfo = UTS.JSON.parse(userInfoStr);\n            }\n            // 从服务器获取最新的用户信息\n            uniCloud.callFunction({\n                name: 'user',\n                data: new UTSJSONObject({\n                    action: 'getUserInfo',\n                    data: new UTSJSONObject({})\n                })\n            }).then(res => {\n                if (res.result.code === 0) {\n                    this.userInfo = res.result.data;\n                    // 更新本地存储\n                    uni.setStorageSync('userInfo', UTS.JSON.stringify(this.userInfo));\n                }\n            });\n        },\n        // 获取角色名称\n        getRoleName(role = null) {\n            const roleMap = new UTSJSONObject({\n                1: '普通用户',\n                2: '评分员',\n                3: '管理员'\n            });\n            return roleMap[role] || '未知角色';\n        },\n        // 保存用户信息\n        saveUserInfo() {\n            if (!this.userInfo.name) {\n                uni.showToast({\n                    title: '姓名不能为空',\n                    icon: 'none'\n                });\n                return null;\n            }\n            uni.showLoading({\n                title: '保存中...'\n            });\n            uniCloud.callFunction({\n                name: 'user',\n                data: new UTSJSONObject({\n                    action: 'updateUserInfo',\n                    data: new UTSJSONObject({\n                        name: this.userInfo.name\n                    })\n                })\n            }).then(res => {\n                uni.hideLoading();\n                if (res.result.code === 0) {\n                    uni.showToast({\n                        title: '保存成功',\n                        icon: 'success'\n                    });\n                    // 更新本地存储\n                    uni.setStorageSync('userInfo', UTS.JSON.stringify(this.userInfo));\n                }\n                else {\n                    uni.showToast({\n                        title: res.result.msg || '保存失败',\n                        icon: 'none'\n                    });\n                }\n            }).catch((err = null) => {\n                uni.hideLoading();\n                uni.__f__('error', 'at pages/user/profile/profile.vue:213', err);\n                uni.showToast({\n                    title: '保存失败，请检查网络',\n                    icon: 'none'\n                });\n            });\n        },\n        // 修改密码\n        changePassword() {\n            // 表单验证\n            if (!this.passwordForm.oldPassword) {\n                uni.showToast({\n                    title: '请输入原密码',\n                    icon: 'none'\n                });\n                return null;\n            }\n            if (!this.passwordForm.newPassword) {\n                uni.showToast({\n                    title: '请输入新密码',\n                    icon: 'none'\n                });\n                return null;\n            }\n            if (this.passwordForm.newPassword.length < 6) {\n                uni.showToast({\n                    title: '新密码长度不能少于6位',\n                    icon: 'none'\n                });\n                return null;\n            }\n            if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {\n                uni.showToast({\n                    title: '两次输入的密码不一致',\n                    icon: 'none'\n                });\n                return null;\n            }\n            uni.showLoading({\n                title: '修改中...'\n            });\n            uniCloud.callFunction({\n                name: 'user',\n                data: new UTSJSONObject({\n                    action: 'changePassword',\n                    data: new UTSJSONObject({\n                        oldPassword: this.passwordForm.oldPassword,\n                        newPassword: this.passwordForm.newPassword\n                    })\n                })\n            }).then(res => {\n                uni.hideLoading();\n                if (res.result.code === 0) {\n                    uni.showToast({\n                        title: '密码修改成功',\n                        icon: 'success'\n                    });\n                    // 重置表单\n                    this.passwordForm = {\n                        oldPassword: '',\n                        newPassword: '',\n                        confirmPassword: ''\n                    };\n                }\n                else {\n                    uni.showToast({\n                        title: res.result.msg || '密码修改失败',\n                        icon: 'none'\n                    });\n                }\n            }).catch((err = null) => {\n                uni.hideLoading();\n                uni.__f__('error', 'at pages/user/profile/profile.vue:292', err);\n                uni.showToast({\n                    title: '密码修改失败，请检查网络',\n                    icon: 'none'\n                });\n            });\n        },\n        // 清除缓存\n        clearCache() {\n            uni.showLoading({\n                title: '清除中...'\n            });\n            // 清除除了登录信息和用户信息之外的缓存\n            try {\n                const token = uni.getStorageSync('token');\n                const userInfo = uni.getStorageSync('userInfo');\n                uni.clearStorageSync();\n                // 重新存储登录信息\n                if (token) {\n                    uni.setStorageSync('token', token);\n                }\n                if (userInfo) {\n                    uni.setStorageSync('userInfo', userInfo);\n                }\n                uni.hideLoading();\n                uni.showToast({\n                    title: '缓存清除成功',\n                    icon: 'success'\n                });\n            }\n            catch (e) {\n                uni.hideLoading();\n                uni.__f__('error', 'at pages/user/profile/profile.vue:329', e);\n                uni.showToast({\n                    title: '缓存清除失败',\n                    icon: 'none'\n                });\n            }\n        },\n        // 关于我们\n        aboutUs() {\n            this.$refs.aboutPopup.open();\n        },\n        // 关闭关于我们弹窗\n        closeAboutPopup() {\n            this.$refs.aboutPopup.close();\n        },\n        // 确认退出登录\n        confirmLogout() {\n            this.$refs.logoutPopup.open();\n        },\n        // 关闭退出登录确认弹窗\n        closeLogoutPopup() {\n            this.$refs.logoutPopup.close();\n        },\n        // 退出登录\n        logout() {\n            // 清除登录信息\n            uni.removeStorageSync('token');\n            uni.removeStorageSync('userInfo');\n            // 跳转到登录页\n            uni.reLaunch({\n                url: '/pages/login/login'\n            });\n        }\n    }\n});\n//# sourceMappingURL=C:/Users/11818/Documents/laoguan/laoguan/pages/user/profile/profile.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getStorageSync","uniCloud.callFunction","uni.setStorageSync","uni.showToast","uni.showLoading","uni.hideLoading","uni.__f__","uni.clearStorageSync","uni.removeStorageSync","uni.reLaunch"],"map":"{\"version\":3,\"file\":\"profile.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"profile.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}

{"code":"import { defineComponent } from \"vue\";\nexport default defineComponent(new UTSJSONObject({\n    data() {\n        return {\n            isLoginMode: true,\n            isForgetMode: false,\n            formData: new UTSJSONObject({\n                username: '',\n                password: '',\n                confirmPassword: '',\n                name: '',\n                workUnit: ''\n            })\n        };\n    },\n    methods: new UTSJSONObject({\n        // 切换到登录模式\n        switchToLogin() {\n            this.isLoginMode = true;\n            this.isForgetMode = false;\n            this.resetForm();\n        },\n        // 切换到注册模式\n        switchToRegister() {\n            this.isLoginMode = false;\n            this.isForgetMode = false;\n            this.resetForm();\n        },\n        // 切换到忘记密码模式\n        switchToForget() {\n            this.isLoginMode = false;\n            this.isForgetMode = true;\n            this.resetForm();\n        },\n        // 重置表单\n        resetForm() {\n            this.formData = {\n                username: '',\n                password: '',\n                confirmPassword: '',\n                name: '',\n                workUnit: ''\n            };\n        },\n        // 表单提交处理\n        handleSubmit() {\n            if (this.isLoginMode) {\n                this.handleLogin();\n            }\n            else if (this.isForgetMode) {\n                this.handleResetPasswordRequest();\n            }\n            else {\n                this.handleRegister();\n            }\n        },\n        // 登录处理\n        handleLogin() {\n            if (!this.formData.username || !this.formData.password) {\n                uni.showToast({\n                    title: '请输入账号和密码',\n                    icon: 'none'\n                });\n                return null;\n            }\n            uni.showLoading({\n                title: '登录中...'\n            });\n            // 调用登录云函数\n            uniCloud.callFunction({\n                name: 'user',\n                data: new UTSJSONObject({\n                    action: 'login',\n                    data: new UTSJSONObject({\n                        username: this.formData.username,\n                        password: this.formData.password\n                    })\n                })\n            }).then(res => {\n                uni.hideLoading();\n                const _a = res.result, code = _a.code, msg = _a.msg, data = _a.data;\n                if (code === 0) {\n                    // 登录成功\n                    // 保存用户信息和token\n                    uni.setStorageSync('token', data.token);\n                    uni.setStorageSync('userInfo', UTS.JSON.stringify(data.user));\n                    uni.showToast({\n                        title: '登录成功',\n                        icon: 'success'\n                    });\n                    // 跳转到首页\n                    setTimeout(() => {\n                        uni.switchTab({\n                            url: '/pages/index/index'\n                        });\n                    }, 1500);\n                }\n                else {\n                    // 登录失败\n                    uni.showToast({\n                        title: msg || '登录失败',\n                        icon: 'none'\n                    });\n                }\n            }).catch((err = null) => {\n                uni.hideLoading();\n                uni.__f__('error', 'at pages/login/login.vue:176', err);\n                uni.showToast({\n                    title: '登录失败，请检查网络',\n                    icon: 'none'\n                });\n            });\n        },\n        // 注册处理\n        handleRegister() {\n            // 表单验证\n            if (!this.formData.username) {\n                uni.showToast({\n                    title: '请输入账号',\n                    icon: 'none'\n                });\n                return null;\n            }\n            if (!this.formData.password) {\n                uni.showToast({\n                    title: '请输入密码',\n                    icon: 'none'\n                });\n                return null;\n            }\n            if (this.formData.password.length < 6) {\n                uni.showToast({\n                    title: '密码长度不能少于6位',\n                    icon: 'none'\n                });\n                return null;\n            }\n            if (this.formData.password !== this.formData.confirmPassword) {\n                uni.showToast({\n                    title: '两次输入的密码不一致',\n                    icon: 'none'\n                });\n                return null;\n            }\n            if (!this.formData.name) {\n                uni.showToast({\n                    title: '请输入真实姓名',\n                    icon: 'none'\n                });\n                return null;\n            }\n            if (!this.formData.workUnit) {\n                uni.showToast({\n                    title: '请输入工作单位',\n                    icon: 'none'\n                });\n                return null;\n            }\n            uni.showLoading({\n                title: '注册中...'\n            });\n            // 调用注册云函数\n            uniCloud.callFunction({\n                name: 'user',\n                data: new UTSJSONObject({\n                    action: 'register',\n                    data: new UTSJSONObject({\n                        username: this.formData.username,\n                        password: this.formData.password,\n                        name: this.formData.name,\n                        workUnit: this.formData.workUnit\n                    })\n                })\n            }).then(res => {\n                uni.hideLoading();\n                const _a = res.result, code = _a.code, msg = _a.msg;\n                if (code === 0) {\n                    // 注册成功\n                    uni.showToast({\n                        title: '注册成功，请登录',\n                        icon: 'success'\n                    });\n                    // 切换到登录模式\n                    setTimeout(() => {\n                        this.isLoginMode = true;\n                        this.isForgetMode = false;\n                        // 保留用户名，清空其他字段\n                        const username = this.formData.username;\n                        this.formData = {\n                            username: username,\n                            password: '',\n                            confirmPassword: '',\n                            name: '',\n                            workUnit: ''\n                        };\n                    }, 1500);\n                }\n                else {\n                    // 注册失败\n                    uni.showToast({\n                        title: msg || '注册失败',\n                        icon: 'none'\n                    });\n                }\n            }).catch((err = null) => {\n                uni.hideLoading();\n                uni.__f__('error', 'at pages/login/login.vue:285', err);\n                uni.showToast({\n                    title: '注册失败，请检查网络',\n                    icon: 'none'\n                });\n            });\n        },\n        // 申请重置密码\n        handleResetPasswordRequest() {\n            // 表单验证\n            if (!this.formData.username) {\n                uni.showToast({\n                    title: '请输入账号',\n                    icon: 'none'\n                });\n                return null;\n            }\n            uni.showLoading({\n                title: '提交申请中...'\n            });\n            // 调用申请重置密码云函数\n            uniCloud.callFunction({\n                name: 'user',\n                data: new UTSJSONObject({\n                    action: 'resetPasswordRequest',\n                    data: new UTSJSONObject({\n                        username: this.formData.username\n                    })\n                })\n            }).then(res => {\n                uni.hideLoading();\n                const _a = res.result, code = _a.code, msg = _a.msg;\n                if (code === 0) {\n                    // 申请成功\n                    uni.showModal(new UTSJSONObject({\n                        title: '申请已提交',\n                        content: '密码重置申请已提交，请等待管理员审核。审核通过后，管理员将通过其他渠道通知您新密码。',\n                        showCancel: false,\n                        success: () => {\n                            // 切换到登录模式\n                            this.isLoginMode = true;\n                            this.isForgetMode = false;\n                            this.formData.username = '';\n                        }\n                    }));\n                }\n                else {\n                    // 申请失败\n                    uni.showToast({\n                        title: msg || '申请失败',\n                        icon: 'none'\n                    });\n                }\n            }).catch((err = null) => {\n                uni.hideLoading();\n                uni.__f__('error', 'at pages/login/login.vue:343', err);\n                uni.showToast({\n                    title: '申请失败，请检查网络',\n                    icon: 'none'\n                });\n            });\n        }\n    })\n}));\n//# sourceMappingURL=C:/Users/11818/Documents/laoguan/laoguan/pages/login/login.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.showToast","uni.showLoading","uniCloud.callFunction","uni.hideLoading","uni.setStorageSync","uni.switchTab","uni.__f__","uni.showModal"],"map":"{\"version\":3,\"file\":\"login.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"login.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}

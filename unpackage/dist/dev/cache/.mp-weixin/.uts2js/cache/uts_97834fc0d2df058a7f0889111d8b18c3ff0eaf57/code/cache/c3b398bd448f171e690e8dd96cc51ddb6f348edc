{"code":"import { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            userInfo: new UTSJSONObject({}),\n            stats: new UTSJSONObject({\n                tableCount: 0,\n                subjectCount: 0,\n                raterCount: 0,\n                ratingCompletionRate: '0%'\n            }),\n            raterStats: new UTSJSONObject({\n                tableCount: 0,\n                ratedCount: 0,\n                pendingCount: 0\n            }),\n            tables: []\n        };\n    },\n    computed: {\n        roleText() {\n            const roleMap = new UTSJSONObject({\n                'admin': '管理员',\n                'rater': '评分员',\n                'user': '普通用户'\n            });\n            return roleMap[this.userInfo.role] || '未知角色';\n        }\n    },\n    onShow() {\n        // 检查登录状态\n        const token = uni.getStorageSync('token');\n        if (!token) {\n            uni.redirectTo({\n                url: '/pages/login/login'\n            });\n            return null;\n        }\n        // 获取用户信息\n        this.userInfo = uni.getStorageSync('userInfo') || new UTSJSONObject({});\n        // 根据角色加载不同数据\n        if (this.userInfo.role === 'admin') {\n            this.loadAdminStats();\n        }\n        else if (this.userInfo.role === 'rater') {\n            this.loadRaterData();\n        }\n    },\n    methods: {\n        navigateTo(url = null) {\n            uni.navigateTo({ url });\n        },\n        goToRating(tableId = null) {\n            uni.navigateTo({\n                url: `/pages/rater/rating/rating?tableId=${tableId}`\n            });\n        },\n        getTableTypeName(type = null) {\n            const typeMap = new UTSJSONObject({\n                1: '(办公室)一般干部评分',\n                2: '(驻村)干部评分',\n                3: '班子评分'\n            });\n            return typeMap[type] || '未知类型';\n        },\n        // 加载管理员统计数据\n        loadAdminStats() {\n            // 调用云函数获取统计数据\n            uniCloud.callFunction({\n                name: 'ratingTable',\n                data: new UTSJSONObject({\n                    action: 'getTables',\n                    data: new UTSJSONObject({})\n                })\n            }).then(res => {\n                if (res.result.code === 0) {\n                    this.stats.tableCount = res.result.data.total || 0;\n                }\n            });\n            uniCloud.callFunction({\n                name: 'subject',\n                data: new UTSJSONObject({\n                    action: 'getSubjects',\n                    data: new UTSJSONObject({})\n                })\n            }).then(res => {\n                if (res.result.code === 0) {\n                    this.stats.subjectCount = res.result.data.total || 0;\n                }\n            });\n            uniCloud.callFunction({\n                name: 'user',\n                data: new UTSJSONObject({\n                    action: 'getUsers',\n                    data: new UTSJSONObject({\n                        role: 'rater'\n                    })\n                })\n            }).then(res => {\n                if (res.result.code === 0) {\n                    this.stats.raterCount = res.result.data.total || 0;\n                }\n            });\n            // 获取评分完成率\n            uniCloud.callFunction({\n                name: 'rating',\n                data: new UTSJSONObject({\n                    action: 'getRatingStats',\n                    data: new UTSJSONObject({})\n                })\n            }).then(res => {\n                if (res.result.code === 0 && res.result.data.length > 0) {\n                    let totalSubjects = 0;\n                    let totalRated = 0;\n                    res.result.data.forEach((item = null) => {\n                        totalSubjects += item.totalSubjects;\n                        totalRated += item.ratedCount;\n                    });\n                    const rate = totalSubjects > 0 ? Math.round((totalRated / totalSubjects) * 100) : 0;\n                    this.stats.ratingCompletionRate = `${rate}%`;\n                }\n            });\n        },\n        // 加载评分员数据\n        loadRaterData() {\n            // 获取分配给当前用户的评分表\n            uniCloud.callFunction({\n                name: 'ratingTable',\n                data: new UTSJSONObject({\n                    action: 'getTables',\n                    data: new UTSJSONObject({\n                        rater: this.userInfo.username\n                    })\n                })\n            }).then(res => {\n                if (res.result.code === 0) {\n                    const tables = res.result.data.list || [];\n                    this.raterStats.tableCount = tables.length;\n                    // 只显示前5个\n                    this.tables = tables.slice(0, 5);\n                    // 获取每个表的评分完成情况\n                    this.tables.forEach((table, index) => {\n                        // 获取该表的考核对象\n                        uniCloud.callFunction({\n                            name: 'subject',\n                            data: new UTSJSONObject({\n                                action: 'getSubjects',\n                                data: new UTSJSONObject({\n                                    table_id: table._id\n                                })\n                            })\n                        }).then(subjectRes => {\n                            const subjects = subjectRes.result.data.list || [];\n                            const totalSubjects = subjects.length;\n                            // 获取该表的评分记录\n                            uniCloud.callFunction({\n                                name: 'rating',\n                                data: new UTSJSONObject({\n                                    action: 'getRatings',\n                                    data: new UTSJSONObject({\n                                        table_id: table._id,\n                                        rater: this.userInfo.username\n                                    })\n                                })\n                            }).then(ratingRes => {\n                                const ratings = ratingRes.result.data.list || [];\n                                const ratedCount = ratings.length;\n                                // 计算完成率\n                                const completion = totalSubjects > 0 ? Math.round((ratedCount / totalSubjects) * 100) : 0;\n                                this.$set(this.tables[index], 'completion', completion);\n                                // 统计已评分和待评分数量\n                                this.raterStats.ratedCount += ratedCount;\n                                this.raterStats.pendingCount += (totalSubjects - ratedCount);\n                            });\n                        });\n                    });\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=C:/Users/11818/Documents/laoguan/laoguan/pages/index/index.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getStorageSync","uni.redirectTo","uni.navigateTo","uniCloud.callFunction"],"map":"{\"version\":3,\"file\":\"index.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"index.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\";AACC,+BAAe;IACd,IAAI;QACH,OAAO;YACN,QAAQ,oBAAE,EAAE,CAAA;YACZ,KAAK,oBAAE;gBACN,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,CAAC;gBACf,UAAU,EAAE,CAAC;gBACb,oBAAoB,EAAE,IAAI;aAC1B,CAAA;YACD,UAAU,oBAAE;gBACX,UAAU,EAAE,CAAC;gBACb,UAAU,EAAE,CAAC;gBACb,YAAY,EAAE,CAAC;aACf,CAAA;YACD,MAAM,EAAE,EAAE;SACV,CAAA;IACF,CAAC;IACD,QAAQ,EAAE;QACT,QAAQ;YACP,MAAM,OAAO,qBAAG;gBACf,OAAO,EAAE,KAAK;gBACd,OAAO,EAAE,KAAK;gBACd,MAAM,EAAE,MAAM;aACd,CAAA,CAAC;YACF,OAAO,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC;QAC9C,CAAC;KACD;IACD,MAAM;QACL,SAAS;QACT,MAAM,KAAK,GAAG,GAAG,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;QAC1C,IAAI,CAAC,KAAK,EAAE;YACX,GAAG,CAAC,UAAU,CAAC;gBACd,GAAG,EAAE,oBAAoB;aACzB,CAAC,CAAC;YACH,YAAO;SACP;QAED,SAAS;QACT,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC,cAAc,CAAC,UAAU,CAAC,sBAAI,EAAE,CAAA,CAAC;QAErD,aAAa;QACb,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,OAAO,EAAE;YACnC,IAAI,CAAC,cAAc,EAAE,CAAC;SACtB;aAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,OAAO,EAAE;YAC1C,IAAI,CAAC,aAAa,EAAE,CAAC;SACrB;IACF,CAAC;IACD,OAAO,EAAE;QACR,UAAU,CAAC,GAAG,OAAA;YACb,GAAG,CAAC,UAAU,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QACzB,CAAC;QACD,UAAU,CAAC,OAAO,OAAA;YACjB,GAAG,CAAC,UAAU,CAAC;gBACd,GAAG,EAAE,sCAAsC,OAAO,EAAE;aACpD,CAAC,CAAC;QACJ,CAAC;QACD,gBAAgB,CAAC,IAAI,OAAA;YACpB,MAAM,OAAO,qBAAG;gBACf,CAAC,EAAE,aAAa;gBAChB,CAAC,EAAE,UAAU;gBACb,CAAC,EAAE,MAAM;aACT,CAAA,CAAC;YACF,OAAO,OAAO,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC;QAChC,CAAC;QACD,YAAY;QACZ,cAAc;YACb,cAAc;YACd,QAAQ,CAAC,YAAY,CAAC;gBACrB,IAAI,EAAE,aAAa;gBACnB,IAAI,oBAAE;oBACL,MAAM,EAAE,WAAW;oBACnB,IAAI,oBAAE,EAAE,CAAA;iBACR,CAAA;aACD,CAAC,CAAC,IAAI,CAAC,GAAG;gBACV,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,EAAE;oBAC1B,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,CAAC;iBACnD;YACF,CAAC,CAAC,CAAC;YAEH,QAAQ,CAAC,YAAY,CAAC;gBACrB,IAAI,EAAE,SAAS;gBACf,IAAI,oBAAE;oBACL,MAAM,EAAE,aAAa;oBACrB,IAAI,oBAAE,EAAE,CAAA;iBACR,CAAA;aACD,CAAC,CAAC,IAAI,CAAC,GAAG;gBACV,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,EAAE;oBAC1B,IAAI,CAAC,KAAK,CAAC,YAAY,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,CAAC;iBACrD;YACF,CAAC,CAAC,CAAC;YAEH,QAAQ,CAAC,YAAY,CAAC;gBACrB,IAAI,EAAE,MAAM;gBACZ,IAAI,oBAAE;oBACL,MAAM,EAAE,UAAU;oBAClB,IAAI,oBAAE;wBACL,IAAI,EAAE,OAAO;qBACb,CAAA;iBACD,CAAA;aACD,CAAC,CAAC,IAAI,CAAC,GAAG;gBACV,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,EAAE;oBAC1B,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,CAAC;iBACnD;YACF,CAAC,CAAC,CAAC;YAEH,UAAU;YACV,QAAQ,CAAC,YAAY,CAAC;gBACrB,IAAI,EAAE,QAAQ;gBACd,IAAI,oBAAE;oBACL,MAAM,EAAE,gBAAgB;oBACxB,IAAI,oBAAE,EAAE,CAAA;iBACR,CAAA;aACD,CAAC,CAAC,IAAI,CAAC,GAAG;gBACV,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;oBACxD,IAAI,aAAa,GAAG,CAAC,CAAC;oBACtB,IAAI,UAAU,GAAG,CAAC,CAAC;oBAEnB,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA,IAAI,OAAA;wBAC3B,aAAa,IAAI,IAAI,CAAC,aAAa,CAAC;wBACpC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC;oBAC/B,CAAC,CAAC,CAAC;oBAEH,MAAM,IAAI,GAAG,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,UAAU,GAAG,aAAa,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACpF,IAAI,CAAC,KAAK,CAAC,oBAAoB,GAAG,GAAG,IAAI,GAAG,CAAC;iBAC7C;YACF,CAAC,CAAC,CAAC;QACJ,CAAC;QACD,UAAU;QACV,aAAa;YACZ,gBAAgB;YAChB,QAAQ,CAAC,YAAY,CAAC;gBACrB,IAAI,EAAE,aAAa;gBACnB,IAAI,oBAAE;oBACL,MAAM,EAAE,WAAW;oBACnB,IAAI,oBAAE;wBACL,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,QAAQ;qBAC7B,CAAA;iBACD,CAAA;aACD,CAAC,CAAC,IAAI,CAAC,GAAG;gBACV,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,EAAE;oBAC1B,MAAM,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC;oBAC1C,IAAI,CAAC,UAAU,CAAC,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC;oBAE3C,SAAS;oBACT,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBAEjC,eAAe;oBACf,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK;wBAChC,YAAY;wBACZ,QAAQ,CAAC,YAAY,CAAC;4BACrB,IAAI,EAAE,SAAS;4BACf,IAAI,oBAAE;gCACL,MAAM,EAAE,aAAa;gCACrB,IAAI,oBAAE;oCACL,QAAQ,EAAE,KAAK,CAAC,GAAG;iCACnB,CAAA;6BACD,CAAA;yBACD,CAAC,CAAC,IAAI,CAAC,UAAU;4BACjB,MAAM,QAAQ,GAAG,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC;4BACnD,MAAM,aAAa,GAAG,QAAQ,CAAC,MAAM,CAAC;4BAEtC,YAAY;4BACZ,QAAQ,CAAC,YAAY,CAAC;gCACrB,IAAI,EAAE,QAAQ;gCACd,IAAI,oBAAE;oCACL,MAAM,EAAE,YAAY;oCACpB,IAAI,oBAAE;wCACL,QAAQ,EAAE,KAAK,CAAC,GAAG;wCACnB,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,QAAQ;qCAC7B,CAAA;iCACD,CAAA;6BACD,CAAC,CAAC,IAAI,CAAC,SAAS;gCAChB,MAAM,OAAO,GAAG,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC;gCACjD,MAAM,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC;gCAElC,QAAQ;gCACR,MAAM,UAAU,GAAG,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,UAAU,GAAG,aAAa,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gCAC1F,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE,YAAY,EAAE,UAAU,CAAC,CAAC;gCAExD,cAAc;gCACd,IAAI,CAAC,UAAU,CAAC,UAAU,IAAI,UAAU,CAAC;gCACzC,IAAI,CAAC,UAAU,CAAC,YAAY,IAAI,CAAC,aAAa,GAAG,UAAU,CAAC,CAAC;4BAC9D,CAAC,CAAC,CAAC;wBACJ,CAAC,CAAC,CAAC;oBACJ,CAAC,CAAC,CAAC;iBACH;YACF,CAAC,CAAC,CAAC;QACJ,CAAC;KACD;CACD,EAAA\"}"}
